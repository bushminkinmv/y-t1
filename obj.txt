Функция callback ссылается на переменную request, которая объявлена в оснвоном цикле, а так как алгоритм подразумевает что в переменной request будет url по которому был произведен запрос, то на момент обращения к переменной, значение переменной может быть неверное, а связанное с другим запросом. Для решения необходимо сделать локальную копию перменной и для этого создаем функцию "обертку", в которую значение переменной request будет скопированно. Чтобы избежать этого в будущем необходимо не использовать глобальные перемнные, а создавать копии.